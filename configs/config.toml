# ==============================================================================
#  üõ°Ô∏è  LoopWarden Configuration
# ==============================================================================

[system]
# Identificador √∫nico de este despliegue (√∫til para saber de qu√© rack viene la alerta)
sensor_name = "LoopWarden-Core-Stack"

# Archivo de logs. Usa "" para consola o "/dev/null" para descartar.
log_file = "loopwarden.log"

[network]
# LoopWarden levantar√° un motor de detecci√≥n independiente para cada interfaz listada.
interfaces = ["eno1", "eno2", "vlan10"] 

# Longitud de captura (SnapShot Length). 2048 bytes es suficiente para cabeceras + payload.
snaplen = 2048

[alerts]
syslog_server = ""  # Ej: "192.168.1.50:514"

# --- GLOBAL ALERT DAMPENING (Smart Silence) ---
# Evita saturar el servidor de correo o Slack durante una tormenta masiva.
[alerts.dampening]
max_alerts_per_minute = 60  # Si se supera, se silencia el sistema.
mute_duration = "60s"       # Tiempo de silencio tras detectar inundaci√≥n de alertas.

# --- Webhook (Slack/Teams/Discord) ---
[alerts.webhook]
enabled = false
url = "https://hooks.slack.com/services/..."

# --- SMTP (Email) ---
[alerts.smtp]
enabled = false
host = "smtp.gmail.com"
port = 587
user = "admin@example.com"
pass = "secret"
to = "ops@example.com"
from = "loopwarden@example.com"

# --- Telegram Bot ---
[alerts.telegram]
enabled = false
token = ""
chat_id = ""

[algorithms]

    # --- ALGORITMO 1: EtherFuse ---
    [algorithms.etherfuse]
    enabled = true
    history_size = 4096
    alert_threshold = 200
    storm_pps_limit = 15000
    alert_cooldown = "5s"  # Frecuencia m√°xima de alertas repetidas por bucle

    # --- ALGORITMO 2: ActiveProbe ---
    [algorithms.active_probe]
    enabled = true
    interval_ms = 1000
    ethertype = 65535
    magic_payload = "LOOPWARDEN_PROBE" 
    
    # --- DOMAIN: Identificador de Red (CR√çTICO PARA M√öLTIPLES SENSORES) ---
    # Define el "Nombre de la Red".
    # - Si dos sensores comparten dominio (ej: "VLAN10"), se ignoran mutuamente (Vecinos).
    # - Si recibes una sonda con dominio diferente, es una ALERTA de cruce de VLANs.
    domain = "default"  

    # --- ALGORITMO 3: MAC Storm ---
    [algorithms.mac_storm]
    enabled = true
    max_pps_per_mac = 2000
    max_tracked_macs = 10000  # L√≠mite de memoria para evitar OOM
    alert_cooldown = "30s"    # Silencio por MAC tras primera alerta

    # --- ALGORITMO 4: FlapGuard ---
    [algorithms.flap_guard]
    enabled = true
    threshold = 5
    window = "1s"           # Ventana de tiempo para contar cambios de VLAN
    alert_cooldown = "30s"  # Silencio por MAC tras detectar flapping

    # --- ALGORITMO 5: ArpWatchdog ---
    [algorithms.arp_watch]
    enabled = true
    max_pps = 500             # L√≠mite para tr√°fico normal
    scan_ip_threshold = 10    # IPs √∫nicas destino para considerar "Escaneo"
    scan_mode_pps = 100       # L√≠mite de PPS m√°s estricto si se detecta modo escaneo
    alert_cooldown = "30s"

    # --- ALGORITMO 6: DhcpHunter ---
    [algorithms.dhcp_hunter]
    enabled = true
    trusted_macs = ["00:15:5d:01:02:03", "aa:bb:cc:dd:ee:ff"] 
    trusted_cidrs = ["192.168.1.0/24", "10.0.0.0/8"]

    # --- ALGORITMO 7: FlowPanic ---
    [algorithms.flow_panic]
    enabled = true
    max_pause_pps = 50 

    # --- ALGORITMO 8: RaGuard ---
    [algorithms.ra_guard]
    enabled = true
    trusted_macs = ["aa:bb:cc:dd:ee:ff"] 

    # --- ALGORITMO 9: McastPolicer ---
    [algorithms.mcast_policer]
    enabled = true
    max_pps = 8000

# --- OVERRIDES: EJEMPLO DE CONFIGURACI√ìN POR INTERFAZ ---
# Aqu√≠ es donde configuras los dominios correctos para cada VLAN.

    # Interfaz conectada a la VLAN 10
    [algorithms.active_probe.overrides.eno1]
    domain = "VLAN_10"    # Si ve otro sensor "VLAN_10", es AMIGO. Si ve "VLAN_20", es CRUCE.

    # Interfaz conectada a la VLAN 20
    [algorithms.active_probe.overrides.eno2]
    domain = "VLAN_20"    # Debe ser distinto al de eno1 para detectar puentes entre ellos.

# --- TELEMETR√çA Y OBSERVABILIDAD ---
[telemetry]
enabled = true
listen_address = ":9090"
